# DASHBOARD
print("\n Creating Master's Level Advanced Interactive Dashboard...")


# Prepare comprehensive data export
data_json = score_df[[
    'ZCTA', 'population', 'median_income', 'pct_bachelors', 'unemployment',
    'rent_burden', 'pct_seniors', 'overall_score', 'score_income',
    'score_education', 'score_employment', 'score_housing', 'score_seniors',
    'cluster_name'
]].to_dict('records')

# Read GeoJSON
with open('ma_zcta_2020.geojson', 'r') as f:
    geo_data = json.load(f)


advanced_dashboard = '''<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Massachusetts ZIP Code Desirability Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard { max-width: 1800px; margin: 0 auto; }

        /* Advanced Header */
        .hero {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            padding: 50px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" fill="rgba(255,255,255,0.05)"/></svg>');
            opacity: 0.3;
        }

        .hero-content { position: relative; z-index: 1; color: white; }
        .hero h1 { font-size: 42px; font-weight: 800; margin-bottom: 12px; letter-spacing: -0.5px; }
        .hero-subtitle { font-size: 18px; opacity: 0.95; margin-bottom: 30px; }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .hero-stat {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s;
        }

        .hero-stat:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-5px);
        }

        .hero-stat-label {
            font-size: 11px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
        }

        .hero-stat-value {
            font-size: 32px;
            font-weight: 700;
        }

        .hero-stat-sub {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        /* Insights Banner */
        .insights-banner {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .insight-box {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 5px solid #1e40af;
            transition: all 0.3s;
        }

        .insight-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .insight-icon {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .insight-title {
            font-size: 13px;
            font-weight: 600;
            color: #1e40af;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .insight-value {
            font-size: 15px;
            color: #334155;
            line-height: 1.6;
        }

        /* Advanced Control Panel */
        .control-panel {
            background: white;
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .control-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .control-title {
            font-size: 22px;
            font-weight: 700;
            color: #1e293b;
        }

        .reset-btn {
            padding: 10px 20px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 600;
            color: #475569;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-value {
            background: #e0e7ff;
            color: #1e40af;
            padding: 2px 10px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 12px;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1e40af;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        input[type="text"], select {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 0 0 3px rgba(30,64,175,0.1);
        }

        /* Section Styles */
        .section {
            background: white;
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .section-subtitle {
            font-size: 14px;
            color: #64748b;
            line-height: 1.5;
        }

        .badge {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            color: #1e40af;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Grid Layouts */
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(650px, 1fr)); gap: 30px; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; }

        /* Comparison Tool */
        .comparison-container {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .comparison-title {
            font-size: 16px;
            font-weight: 600;
            color: #334155;
            margin-bottom: 15px;
        }

        .zip-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .chip {
            padding: 12px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 14px;
            color: #475569;
        }

        .chip:hover {
            border-color: #1e40af;
            background: #eff6ff;
            transform: scale(1.05);
        }

        .chip.selected {
            background: linear-gradient(135deg, #1e40af, #7c3aed);
            color: white;
            border-color: #1e40af;
        }

        .comparison-info {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 13px;
            color: #78350f;
        }

        /* Advanced Table */
        .table-container {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-height: 650px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #1e40af, #7c3aed);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        th:hover {
            background: rgba(0,0,0,0.1);
        }

        th::after {
            content: ' ‚Üï';
            opacity: 0.5;
        }

        td {
            padding: 14px 16px;
            font-size: 13px;
            border-bottom: 1px solid #f1f5f9;
        }

        tbody tr {
            transition: all 0.2s;
        }

        tbody tr:hover {
            background: linear-gradient(90deg, #f8fafc, #f1f5f9);
            transform: scale(1.005);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        tbody tr:nth-child(even) {
            background: #fafbfc;
        }

        .score-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 12px;
            color: white;
            text-align: center;
            min-width: 50px;
        }

        .s-excellent { background: linear-gradient(135deg, #10b981, #059669); }
        .s-good { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .s-fair { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .s-poor { background: linear-gradient(135deg, #ef4444, #dc2626); }

        .cluster-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .cluster-high { background: #dcfce7; color: #166534; }
        .cluster-mod-high { background: #dbeafe; color: #1e40af; }
        .cluster-mod-low { background: #fef3c7; color: #92400e; }
        .cluster-low { background: #fee2e2; color: #991b1b; }

        /* Methodology Section */
        .methodology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .method-card {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .weight-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #1e40af;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
        }

        .method-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .method-title {
            font-size: 16px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .method-desc {
            font-size: 13px;
            color: #64748b;
            line-height: 1.6;
        }

        /* Citations */
        .citations {
            margin-top: 30px;
        }

        .citation {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            padding: 18px;
            border-left: 4px solid #1e40af;
            margin: 12px 0;
            border-radius: 6px;
            font-size: 12px;
            line-height: 1.8;
            color: #475569;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px;
            color: #94a3b8;
        }

        .spinner {
            border: 4px solid #f1f5f9;
            border-top: 4px solid #1e40af;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .hero h1 { font-size: 32px; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Hero Header -->
        <div class="hero">
            <div class="hero-content">
                <h1>Massachusetts ZIP Code Desirability Dashboard</h1>
                <div class="hero-subtitle">
                    Advanced Interactive Analysis ‚Ä¢ 493 ZIP Codes ‚Ä¢ ACS 2019-2023 5-Year Estimates
                </div>
                <div class="hero-stats">
                    <div class="hero-stat">
                        <div class="hero-stat-label">Average Score</div>
                        <div class="hero-stat-value" id="stat-score">--</div>
                        <div class="hero-stat-sub">Overall desirability</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-label">Analyzed ZIPs</div>
                        <div class="hero-stat-value" id="stat-count">--</div>
                        <div class="hero-stat-sub">After filtering</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-label">Median Income</div>
                        <div class="hero-stat-value" id="stat-income">--</div>
                        <div class="hero-stat-sub">Regional average</div>
                    </div>
                    <div class="hero-stat">
                        <div class="hero-stat-label">Education Level</div>
                        <div class="hero-stat-value" id="stat-edu">--</div>
                        <div class="hero-stat-sub">Bachelor's degree+</div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Key Insights -->
        <div class="insights-banner">
            <div class="insight-box">
                <div class="insight-icon">üèÜ</div>
                <div class="insight-title">Top Performer</div>
                <div class="insight-value" id="insight-top">Analyzing data...</div>
            </div>
            <div class="insight-box">
                <div class="insight-icon">üìä</div>
                <div class="insight-title">Distribution Pattern</div>
                <div class="insight-value" id="insight-dist">Analyzing data...</div>
            </div>
            <div class="insight-box">
                <div class="insight-icon">üîó</div>
                <div class="insight-title">Key Correlation</div>
                <div class="insight-value" id="insight-corr">Analyzing data...</div>
            </div>
        </div>

        <!-- Advanced Control Panel -->
        <div class="control-panel">
            <div class="control-header">
                <div class="control-title">üéõÔ∏è Advanced Filtering System</div>
                <button class="reset-btn" onclick="resetFilters()">Reset All Filters</button>
            </div>
            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">
                        <span>Overall Score Range</span>
                        <span class="filter-value" id="range-display">0 - 100</span>
                    </label>
                    <input type="range" id="score-range" min="0" max="100" value="100">
                </div>
                <div class="filter-group">
                    <label class="filter-label">
                        <span>Minimum Population</span>
                        <span class="filter-value" id="pop-display">0</span>
                    </label>
                    <input type="range" id="pop-range" min="0" max="50000" value="0" step="1000">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Performance Cluster</label>
                    <select id="cluster-filter">
                        <option value="">All Clusters</option>
                        <option value="High Performing">üü¢ High Performing</option>
                        <option value="Moderate-High">üîµ Moderate-High</option>
                        <option value="Moderate-Low">üü° Moderate-Low</option>
                        <option value="Needs Improvement">üî¥ Needs Improvement</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Search ZIP Code</label>
                    <input type="text" id="search-zip" placeholder="Enter ZIP code (e.g., 02138)">
                </div>
            </div>
        </div>

        <!-- Main Visualizations -->
        <div class="grid-2">
            <div class="section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Top 20 Performing ZIP Codes</div>
                        <div class="section-subtitle">Highest overall desirability scores</div>
                    </div>
                    <span class="badge">Bar Chart</span>
                </div>
                <div id="chart-top20" style="height:450px"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Score Distribution Analysis</div>
                        <div class="section-subtitle">Frequency distribution of overall scores</div>
                    </div>
                    <span class="badge">Histogram</span>
                </div>
                <div id="chart-histogram" style="height:450px"></div>
            </div>
        </div>

        <!-- Choropleth Maps -->
        <div class="section">
            <div class="section-header">
                <div>
                    <div class="section-title">Geographic Heatmap: Overall Desirability Scores</div>
                    <div class="section-subtitle">Choropleth visualization showing composite scores across Massachusetts ZIP codes</div>
                </div>
                <span class="badge">Choropleth Map</span>
            </div>
            <div id="map-scores" style="height:700px"></div>
        </div>

        <div class="section">
            <div class="section-header">
                <div>
                    <div>
                        <div class="section-title">Geographic Clustering: Performance Categories</div>
                        <div class="section-subtitle">K-Means clustering (k=4) revealing regional socioeconomic patterns</div>
                    </div>
                    <span class="badge">Cluster Map</span>
                </div>
            </div>
            <div id="map-clusters" style="height:700px"></div>
        </div>

        <!-- Correlation Analysis -->
        <div class="grid-2">
            <div class="section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Income-Score Correlation</div>
                        <div class="section-subtitle">Relationship between median income and desirability</div>
                    </div>
                    <span class="badge">Scatter Plot</span>
                </div>
                <div id="chart-scatter-income" style="height:420px"></div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div>
                        <div class="section-title">Education-Score Correlation</div>
                        <div class="section-subtitle">Relationship between education and desirability</div>
                    </div>
                    <span class="badge">Scatter Plot</span>
                </div>
                <div id="chart-scatter-edu" style="height:420px"></div>
            </div>
        </div>

        <!-- Heatmap -->
        <div class="section">
            <div class="section-header">
                <div>
                    <div class="section-title">Dimension Score Heatmap: Comparative Analysis</div>
                    <div class="section-subtitle">Top 15 vs. Bottom 15 ZIP codes across all five performance dimensions</div>
                </div>
                <span class="badge">Heatmap</span>
            </div>
            <div id="chart-heatmap" style="height:800px"></div>
        </div>

        <!-- Cluster Comparison -->
        <div class="section">
            <div class="section-header">
                <div>
                    <div class="section-title">Performance Cluster Analysis</div>
                    <div class="section-subtitle">Average dimension scores by cluster group</div>
                </div>
                <span class="badge">Grouped Bar Chart</span>
            </div>
            <div id="chart-cluster-avg" style="height:480px"></div>
        </div>

        <!-- ZIP Comparison Tool -->
        <div class="section">
            <div class="section-header">
                <div>
                    <div class="section-title">Multi-ZIP Comparison Tool</div>
                    <div class="section-subtitle">Interactive side-by-side comparison (select up to 5 ZIP codes)</div>
                </div>
                <span class="badge">Interactive Tool</span>
            </div>
            <div class="comparison-container">
                <div class="comparison-title">Select ZIP Codes to Compare:</div>
                <div class="zip-chips" id="zip-selector"></div>
                <div class="comparison-info" id="comparison-info" style="display:none;">
                    <strong>üí° Tip:</strong> Click on ZIP codes above to add them to the comparison.
                    You can select up to 5 ZIP codes at once.
                </div>
            </div>
            <div id="chart-comparison" style="height:450px"></div>
        </div>

        <!-- Data Table -->
        <div class="section">
            <div class="section-header">
                <div>
                    <div class="section-title">Comprehensive Data Table</div>
                    <div class="section-subtitle">Complete dataset with sortable columns ‚Ä¢ <span id="table-count-display">--</span> ZIP codes displayed</div>
                </div>
                <span class="badge">Interactive Table</span>
            </div>
            <div class="table-container">
                <table id="data-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">ZIP Code</th>
                            <th onclick="sortTable(1)">Population</th>
                            <th onclick="sortTable(2)">Overall Score</th>
                            <th onclick="sortTable(3)">Median Income</th>
                            <th onclick="sortTable(4)">Education %</th>
                            <th onclick="sortTable(5)">Unemployment %</th>
                            <th onclick="sortTable(6)">Rent Burden %</th>
                            <th onclick="sortTable(7)">Cluster</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- Methodology -->
        <div class="section">
            <div class="section-title" style="margin-bottom:15px;">üìö Methodology & Scoring Framework</div>
            <div class="section-subtitle" style="margin-bottom:25px;">
                The overall desirability score is computed as a weighted composite of five normalized dimension scores
                using min-max scaling methodology to ensure comparability across metrics.
            </div>

            <div class="methodology-grid">
                <div class="method-card">
                    <div class="weight-badge">25%</div>
                    <div class="method-icon">üí∞</div>
                    <div class="method-title">Income Score</div>
                    <div class="method-desc">
                        Min-max normalized median household income (S1901_C01_012E).
                        Higher income receives higher scores, reflecting economic prosperity and purchasing power.
                    </div>
                </div>

                <div class="method-card">
                    <div class="weight-badge">25%</div>
                    <div class="method-icon">üéì</div>
                    <div class="method-title">Education Score</div>
                    <div class="method-desc">
                        Percentage of population aged 25+ with bachelor's degree or higher (S1501_C02_015E).
                        Reflects human capital and educational attainment levels.
                    </div>
                </div>

                <div class="method-card">
                    <div class="weight-badge">20%</div>
                    <div class="method-icon">üíº</div>
                    <div class="method-title">Employment Score</div>
                    <div class="method-desc">
                        Inverse normalized unemployment rate for population 16+ in labor force (S2301_C04_001E).
                        Lower unemployment equals higher score.
                    </div>
                </div>

                <div class="method-card">
                    <div class="weight-badge">20%</div>
                    <div class="method-icon">üè†</div>
                    <div class="method-title">Housing Affordability Score</div>
                    <div class="method-desc">
                        Inverse of rent burden - percentage of renter households paying ‚â•35% of income on rent (DP04_0142PE).
                        Lower burden indicates better housing affordability.
                    </div>
                </div>

                <div class="method-card">
                    <div class="weight-badge">10%</div>
                    <div class="method-icon">üë•</div>
                    <div class="method-title">Age Structure Score</div>
                    <div class="method-desc">
                        Inverse of percentage population aged 65+ (DP05_0024PE).
                        Accounts for demographic diversity and working-age population ratio.
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Sources -->
        <div class="section">
            <div class="section-title" style="margin-bottom:15px;">üìñ Data Sources & Citations (APA Format)</div>
            <div class="section-subtitle" style="margin-bottom:20px;">
                All data sourced from the U.S. Census Bureau's American Community Survey
            </div>

            <div class="citations">
                <div class="citation">
                    U.S. Census Bureau. (2024). <em>American Community Survey 2019‚Äì2023 5-year estimates,
                    table DP04: Selected Housing Characteristics</em> [Data set]. Retrieved from https://data.census.gov
                </div>

                <div class="citation">
                    U.S. Census Bureau. (2024). <em>American Community Survey 2019‚Äì2023 5-year estimates,
                    table DP05: ACS Demographic and Housing Estimates</em> [Data set]. Retrieved from https://data.census.gov
                </div>

                <div class="citation">
                    U.S. Census Bureau. (2024). <em>American Community Survey 2019‚Äì2023 5-year estimates,
                    table S1501: Educational Attainment</em> [Data set]. Retrieved from https://data.census.gov
                </div>

                <div class="citation">
                    U.S. Census Bureau. (2024). <em>American Community Survey 2019‚Äì2023 5-year estimates,
                    table S1901: Income in the Past 12 Months (in 2023 Inflation-Adjusted Dollars)</em> [Data set].
                    Retrieved from https://data.census.gov
                </div>

                <div class="citation">
                    U.S. Census Bureau. (2024). <em>American Community Survey 2019‚Äì2023 5-year estimates,
                    table S2301: Employment Status</em> [Data set]. Retrieved from https://data.census.gov
                </div>

                <div class="citation">
                    U.S. Census Bureau. (2023). <em>2020 Census 5-digit ZIP Code Tabulation Area (ZCTA5) TIGER/Line Shapefile</em>
                    [Shapefile]. Retrieved from https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html
                </div>
            </div>

            <div style="margin-top:25px; padding-top:25px; border-top:2px solid #e2e8f0; color:#64748b; font-size:13px; line-height:1.8;">
                <strong>Project Information:</strong> This dashboard was developed for the Computerization and Visualization
                course at Northeastern University. The analysis employs advanced data science techniques including K-Means clustering,
                min-max normalization, and interactive geospatial visualization. Technologies used: Python (Pandas, NumPy,
                Scikit-learn, GeoPandas, Plotly), HTML5, CSS3, JavaScript, and D3.js.
            </div>
        </div>
    </div>

    <script>
        // EMBEDDED DATA
        const allData = ''' + json.dumps(data_json) + ''';
        const geoData = ''' + json.dumps(geo_data) + ''';

        let filteredData = allData;
        let selectedZips = [];

        // Color mappings
        const clusterColors = {
            'High Performing': '#10b981',
            'Moderate-High': '#3b82f6',
            'Moderate-Low': '#f59e0b',
            'Needs Improvement': '#ef4444'
        };

        // Initialize dashboard
        function init() {
            updateAll();
            setupEventListeners();
        }

        function updateAll() {
            applyFilters();
            updateHeaderStats();
            updateInsights();
            updateCharts();
            updateMaps();
            updateTable();
            updateZipSelector();
        }

        function applyFilters() {
            const maxScore = +document.getElementById('score-range').value;
            const minPop = +document.getElementById('pop-range').value;
            const search = document.getElementById('search-zip').value.toLowerCase();
            const cluster = document.getElementById('cluster-filter').value;

            filteredData = allData.filter(d =>
                d.overall_score <= maxScore &&
                d.population >= minPop &&
                (search === '' || d.ZCTA.toLowerCase().includes(search)) &&
                (cluster === '' || d.cluster_name === cluster)
            );
        }

        function updateHeaderStats() {
            const avg = d3.mean(filteredData, d => d.overall_score);
            const avgInc = d3.mean(filteredData, d => d.median_income);
            const avgEdu = d3.mean(filteredData, d => d.pct_bachelors);

            document.getElementById('stat-score').textContent = avg.toFixed(1);
            document.getElementById('stat-count').textContent = filteredData.length;
            document.getElementById('stat-income').textContent = '$' + (avgInc/1000).toFixed(0) + 'K';
            document.getElementById('stat-edu').textContent = avgEdu.toFixed(1) + '%';
        }

        function updateInsights() {
            const sorted = [...filteredData].sort((a,b) => b.overall_score - a.overall_score);
            const top = sorted[0];
            const std = d3.deviation(filteredData, d => d.overall_score);
            const min = d3.min(filteredData, d => d.overall_score);
            const max = d3.max(filteredData, d => d.overall_score);

            // Calculate correlation
            const incomes = filteredData.map(d => d.median_income);
            const scores = filteredData.map(d => d.overall_score);
            const meanInc = d3.mean(incomes);
            const meanScore = d3.mean(scores);
            const numerator = d3.sum(incomes.map((inc, i) => (inc - meanInc) * (scores[i] - meanScore)));
            const denomInc = Math.sqrt(d3.sum(incomes.map(inc => Math.pow(inc - meanInc, 2))));
            const denomScore = Math.sqrt(d3.sum(scores.map(score => Math.pow(score - meanScore, 2))));
            const corr = numerator / (denomInc * denomScore);

            document.getElementById('insight-top').textContent =
                `ZIP ${top.ZCTA} achieves the highest score of ${top.overall_score.toFixed(1)} with median income of $${(top.median_income/1000).toFixed(0)}K and ${top.pct_bachelors.toFixed(1)}% education rate.`;

            document.getElementById('insight-dist').textContent =
                `Scores exhibit a range from ${min.toFixed(1)} to ${max.toFixed(1)} (span: ${(max-min).toFixed(1)} points) with standard deviation of ${std.toFixed(2)}, indicating ${std > 15 ? 'high' : std > 10 ? 'moderate' : 'low'} variability across regions.`;

            document.getElementById('insight-corr').textContent =
                `${corr > 0.8 ? 'Strong' : corr > 0.6 ? 'Moderate' : 'Weak'} positive correlation (r = ${corr.toFixed(3)}) between median income and overall score, suggesting income is a ${corr > 0.8 ? 'primary' : 'significant'} determinant of regional desirability.`;
        }

        function updateCharts() {
            // Top 20 Bar Chart
            const top20 = [...filteredData].sort((a,b) => b.overall_score - a.overall_score).slice(0,20);

            Plotly.newPlot('chart-top20', [{
                x: top20.map(d => d.ZCTA),
                y: top20.map(d => d.overall_score),
                type: 'bar',
                marker: {
                    color: top20.map(d => d.overall_score),
                    colorscale: 'RdYlGn',
                    showscale: true,
                    colorbar: {title: {text: 'Score', font: {size: 12}}, len: 0.7}
                },
                text: top20.map(d => d.overall_score.toFixed(1)),
                textposition: 'outside',
                hovertemplate: '<b>ZIP %{x}</b><br>Score: %{y:.1f}<br>Income: $%{customdata:,.0f}<extra></extra>',
                customdata: top20.map(d => d.median_income)
            }], {
                xaxis: {title: 'ZIP Code', tickangle: -45},
                yaxis: {title: 'Overall Desirability Score', range: [0, Math.max(...top20.map(d => d.overall_score)) + 10]},
                margin: {t:30, r:20, b:100, l:70}
            }, {responsive: true});

            // Histogram
            Plotly.newPlot('chart-histogram', [{
                x: filteredData.map(d => d.overall_score),
                type: 'histogram',
                nbinsx: 25,
                marker: {color: '#1e40af', line: {color: 'white', width: 1}},
                hovertemplate: 'Score Range: %{x}<br>Frequency: %{y}<extra></extra>'
            }], {
                xaxis: {title: 'Overall Score'},
                yaxis: {title: 'Number of ZIP Codes'},
                margin: {t:30, r:20, b:70, l:70},
                shapes: [{
                    type: 'line',
                    x0: d3.mean(filteredData, d => d.overall_score),
                    x1: d3.mean(filteredData, d => d.overall_score),
                    y0: 0,
                    y1: 1,
                    yref: 'paper',
                    line: {color: 'red', width: 2, dash: 'dash'}
                }],
                annotations: [{
                    x: d3.mean(filteredData, d => d.overall_score),
                    y: 1,
                    yref: 'paper',
                    text: `Mean: ${d3.mean(filteredData, d => d.overall_score).toFixed(1)}`,
                    showarrow: false,
                    yanchor: 'bottom',
                    font: {color: 'red', size: 11, weight: 'bold'}
                }]
            }, {responsive: true});

            // Scatter Plots
            const clusters = [...new Set(filteredData.map(d => d.cluster_name))];

            const scatterIncome = clusters.map(cluster => ({
                x: filteredData.filter(d => d.cluster_name === cluster).map(d => d.median_income),
                y: filteredData.filter(d => d.cluster_name === cluster).map(d => d.overall_score),
                mode: 'markers',
                name: cluster,
                marker: {size: 10, color: clusterColors[cluster], opacity: 0.7, line: {color: 'white', width: 1}},
                text: filteredData.filter(d => d.cluster_name === cluster).map(d => d.ZCTA),
                hovertemplate: '<b>ZIP %{text}</b><br>Income: $%{x:,.0f}<br>Score: %{y:.1f}<extra></extra>'
            }));

            Plotly.newPlot('chart-scatter-income', scatterIncome, {
                xaxis: {title: 'Median Household Income ($)'},
                yaxis: {title: 'Overall Desirability Score'},
                margin: {t:30, r:20, b:70, l:70},
                legend: {orientation: 'h', y: -0.3, x: 0.5, xanchor: 'center'}
            }, {responsive: true});

            const scatterEdu = clusters.map(cluster => ({
                x: filteredData.filter(d => d.cluster_name === cluster).map(d => d.pct_bachelors),
                y: filteredData.filter(d => d.cluster_name === cluster).map(d => d.overall_score),
                mode: 'markers',
                name: cluster,
                marker: {size: 10, color: clusterColors[cluster], opacity: 0.7, line: {color: 'white', width: 1}},
                text: filteredData.filter(d => d.cluster_name === cluster).map(d => d.ZCTA),
                hovertemplate: '<b>ZIP %{text}</b><br>Education: %{x:.1f}%<br>Score: %{y:.1f}<extra></extra>'
            }));

            Plotly.newPlot('chart-scatter-edu', scatterEdu, {
                xaxis: {title: "% Population with Bachelor's Degree or Higher"},
                yaxis: {title: 'Overall Desirability Score'},
                margin: {t:30, r:20, b:70, l:70},
                legend: {orientation: 'h', y: -0.3, x: 0.5, xanchor: 'center'}
            }, {responsive: true});

            // Heatmap
            const top15 = [...filteredData].sort((a,b) => b.overall_score - a.overall_score).slice(0,15);
            const bottom15 = [...filteredData].sort((a,b) => a.overall_score - b.overall_score).slice(0,15);
            const heatData = [...top15, ...bottom15];
            const heatZ = heatData.map(d => [d.score_income, d.score_education, d.score_employment, d.score_housing, d.score_seniors]);

            Plotly.newPlot('chart-heatmap', [{
                z: heatZ,
                x: ['Income Score', 'Education Score', 'Employment Score', 'Housing Score', 'Age Structure Score'],
                y: heatData.map(d => `${d.ZCTA} (${d.overall_score.toFixed(1)})`),
                type: 'heatmap',
                colorscale: 'RdYlGn',
                text: heatZ.map(row => row.map(v => v.toFixed(1))),
                texttemplate: '%{text}',
                textfont: {size: 11},
                colorbar: {title: {text: 'Dimension<br>Score', font: {size: 12}}},
                hovertemplate: 'ZIP: %{y}<br>%{x}: %{z:.1f}<extra></extra>'
            }], {
                xaxis: {title: 'Performance Dimension', side: 'bottom', tickangle: -20},
                yaxis: {title: 'ZIP Code (Overall Score)', autorange: 'reversed'},
                margin: {t:30, r:20, b:100, l:140}
            }, {responsive: true});

            // Cluster Average Comparison
            const clusterStats = {};
            clusters.forEach(cluster => {
                const clusterData = filteredData.filter(d => d.cluster_name === cluster);
                clusterStats[cluster] = {
                    income: d3.mean(clusterData, d => d.score_income),
                    education: d3.mean(clusterData, d => d.score_education),
                    employment: d3.mean(clusterData, d => d.score_employment),
                    housing: d3.mean(clusterData, d => d.score_housing),
                    seniors: d3.mean(clusterData, d => d.score_seniors)
                };
            });

            const dims = ['Income', 'Education', 'Employment', 'Housing', 'Age Structure'];
            const dimKeys = ['income', 'education', 'employment', 'housing', 'seniors'];
            const clusterTraces = dims.map((dim, idx) => ({
                x: clusters,
                y: clusters.map(c => clusterStats[c][dimKeys[idx]]),
                name: dim,
                type: 'bar',
                text: clusters.map(c => clusterStats[c][dimKeys[idx]].toFixed(1)),
                textposition: 'outside',
                hovertemplate: '%{x}<br>' + dim + ': %{y:.1f}<extra></extra>'
            }));

            Plotly.newPlot('chart-cluster-avg', clusterTraces, {
                barmode: 'group',
                xaxis: {title: 'Performance Cluster', tickangle: -15},
                yaxis: {title: 'Average Dimension Score', range: [0, 100]},
                margin: {t:30, r:20, b:120, l:70},
                legend: {orientation: 'h', y: -0.35, x: 0.5, xanchor: 'center'}
            }, {responsive: true});
        }

        function updateMaps() {
            // Score Map
            Plotly.newPlot('map-scores', [{
                type: 'choroplethmapbox',
                locations: filteredData.map(d => d.ZCTA),
                z: filteredData.map(d => d.overall_score),
                geojson: geoData,
                featureidkey: 'properties.ZCTA5CE20',
                colorscale: 'RdYlGn',
                marker: {opacity: 0.75, line: {color: 'white', width: 0.5}},
                colorbar: {title: {text: 'Overall<br>Score', font: {size: 13}}},
                hovertemplate: '<b>ZIP Code: %{location}</b><br>Overall Score: %{z:.1f}<br><extra></extra>'
            }], {
                mapbox: {style: 'carto-positron', center: {lat: 42.3, lon: -71.8}, zoom: 7},
                margin: {t:0, r:0, b:0, l:0}
            }, {responsive: true});

            // Cluster Map
            const clusters = [...new Set(filteredData.map(d => d.cluster_name))];
            const clusterTraces = clusters.map(cluster => ({
                type: 'choroplethmapbox',
                locations: filteredData.filter(d => d.cluster_name === cluster).map(d => d.ZCTA),
                z: filteredData.filter(d => d.cluster_name === cluster).map(() => 1),
                geojson: geoData,
                featureidkey: 'properties.ZCTA5CE20',
                colorscale: [[0, clusterColors[cluster]], [1, clusterColors[cluster]]],
                showscale: false,
                name: cluster,
                marker: {opacity: 0.75, line: {color: 'white', width: 0.5}},
                hovertemplate: '<b>ZIP: %{location}</b><br>Cluster: ' + cluster + '<extra></extra>'
            }));

            Plotly.newPlot('map-clusters', clusterTraces, {
                mapbox: {style: 'carto-positron', center: {lat: 42.3, lon: -71.8}, zoom: 7},
                margin: {t:0, r:0, b:0, l:0},
                showlegend: true,
                legend: {
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(255,255,255,0.95)',
                    bordercolor: '#e2e8f0',
                    borderwidth: 1
                }
            }, {responsive: true});
        }

        function updateTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            document.getElementById('table-count-display').textContent = filteredData.length;

            const sorted = [...filteredData].sort((a,b) => b.overall_score - a.overall_score);

            sorted.forEach(d => {
                const scoreClass = d.overall_score >= 75 ? 's-excellent' :
                                  d.overall_score >= 60 ? 's-good' :
                                  d.overall_score >= 40 ? 's-fair' : 's-poor';

                const clusterClass = d.cluster_name === 'High Performing' ? 'cluster-high' :
                                    d.cluster_name === 'Moderate-High' ? 'cluster-mod-high' :
                                    d.cluster_name === 'Moderate-Low' ? 'cluster-mod-low' : 'cluster-low';

                tbody.innerHTML += `<tr>
                    <td><strong>${d.ZCTA}</strong></td>
                    <td>${d.population.toLocaleString()}</td>
                    <td><span class="score-badge ${scoreClass}">${d.overall_score.toFixed(1)}</span></td>
                    <td>$${d.median_income.toLocaleString()}</td>
                    <td>${d.pct_bachelors.toFixed(1)}%</td>
                    <td>${d.unemployment.toFixed(1)}%</td>
                    <td>${d.rent_burden.toFixed(1)}%</td>
                    <td><span class="cluster-tag ${clusterClass}">${d.cluster_name}</span></td>
                </tr>`;
            });
        }

        function updateZipSelector() {
            const container = document.getElementById('zip-selector');
            container.innerHTML = '';
            const top40 = [...filteredData].sort((a,b) => b.overall_score - a.overall_score).slice(0,40);

            top40.forEach(d => {
                const chip = document.createElement('div');
                chip.className = 'chip' + (selectedZips.includes(d.ZCTA) ? ' selected' : '');
                chip.textContent = `${d.ZCTA} (${d.overall_score.toFixed(1)})`;
                chip.onclick = () => toggleZipSelection(d.ZCTA);
                container.appendChild(chip);
            });

            updateComparison();
        }

        function toggleZipSelection(zip) {
            if (selectedZips.includes(zip)) {
                selectedZips = selectedZips.filter(z => z !== zip);
            } else if (selectedZips.length < 5) {
                selectedZips.push(zip);
            } else {
                alert('Maximum 5 ZIP codes can be selected for comparison. Please deselect one first.');
                return;
            }
            updateZipSelector();
        }

        function updateComparison() {
            const infoBox = document.getElementById('comparison-info');

            if (selectedZips.length === 0) {
                document.getElementById('chart-comparison').innerHTML =
                    '<div class="loading"><div class="spinner"></div><p>Select ZIP codes above to begin multi-dimensional comparison</p></div>';
                infoBox.style.display = 'block';
                return;
            }

            infoBox.style.display = 'none';

            const dims = ['Income', 'Education', 'Employment', 'Housing', 'Age Structure'];
            const dimKeys = ['income', 'education', 'employment', 'housing', 'seniors'];

            const traces = dims.map((dim, idx) => ({
                x: selectedZips,
                y: selectedZips.map(zip => {
                    const d = allData.find(d => d.ZCTA === zip);
                    return d ? d['score_' + dimKeys[idx]] : 0;
                }),
                name: dim,
                type: 'bar',
                text: selectedZips.map(zip => {
                    const d = allData.find(d => d.ZCTA === zip);
                    return d ? d['score_' + dimKeys[idx]].toFixed(1) : '0';
                }),
                textposition: 'outside'
            }));

            Plotly.newPlot('chart-comparison', traces, {
                barmode: 'group',
                xaxis: {title: 'ZIP Code'},
                yaxis: {title: 'Dimension Score', range: [0, 105]},
                margin: {t:30, r:20, b:70, l:70},
                legend: {orientation: 'h', y: -0.25, x: 0.5, xanchor: 'center'}
            }, {responsive: true});
        }

        let sortDirection = {};
        function sortTable(colIndex) {
            const tbody = document.getElementById('table-body');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            sortDirection[colIndex] = !sortDirection[colIndex];
            const ascending = sortDirection[colIndex];

            rows.sort((a, b) => {
                const aVal = a.cells[colIndex].textContent.replace(/[$,%]/g, '');
                const bVal = b.cells[colIndex].textContent.replace(/[$,%]/g, '');
                const aNum = parseFloat(aVal);
                const bNum = parseFloat(bVal);

                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return ascending ? aNum - bNum : bNum - aNum;
                }
                return ascending ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
            });

            rows.forEach(row => tbody.appendChild(row));
        }

        function resetFilters() {
            document.getElementById('score-range').value = 100;
            document.getElementById('pop-range').value = 0;
            document.getElementById('search-zip').value = '';
            document.getElementById('cluster-filter').value = '';
            updateAll();
        }

        function setupEventListeners() {
            document.getElementById('score-range').oninput = e => {
                document.getElementById('range-display').textContent = '0 - ' + e.target.value;
                updateAll();
            };

            document.getElementById('pop-range').oninput = e => {
                document.getElementById('pop-display').textContent = (+e.target.value).toLocaleString();
                updateAll();
            };

            document.getElementById('search-zip').oninput = updateAll;
            document.getElementById('cluster-filter').onchange = updateAll;
        }

        // Initialize
        init();
    </script>
</body>
</html>'''

# Save the file
with open('index.html', 'w', encoding='utf-8') as f:
    f.write(advanced_dashboard)


print(" File: index.html")



from google.colab import files
files.download('index.html')

